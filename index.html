<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ ªã‚²ãƒ¼ãƒ </title>
  <link rel="icon" href="favicon.ico" type="image/x-icon"> <!-- ã‚¢ã‚¤ã‚³ãƒ³ã®è¿½åŠ  -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 20px;
    }
    .info {
      margin-top: 20px;
      font-size: 18px;
    }
    canvas {
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
    }
    #message {
      color: red;
      font-size: 16px;
      margin-top: 10px;
    }
    #popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 10px;
      font-size: 20px;
      text-align: center;
    }
    #giftPopup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 10px;
      font-size: 20px;
      text-align: center;
    }
    input {
      padding: 10px;
      font-size: 16px;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>æ ªã‚²ãƒ¼ãƒ </h1>
  <p>æ ªä¾¡ã®å¤‰å‹•ã‚’è¿½ã„ãªãŒã‚‰å–å¼•ã‚’è¡Œã„ã€åˆ©ç›Šã‚’ä¸Šã’ã¾ã—ã‚‡ã†ï¼</p>

  <!-- æ ªä¾¡ã®ã‚°ãƒ©ãƒ• -->
  <canvas id="stockChart" width="400" height="200"></canvas>

  <!-- ã‚²ãƒ¼ãƒ æƒ…å ± -->
  <div class="info">
    <p>æ‰€æŒé‡‘: <span id="money">10000</span>å††</p>
    <p>æ‰€æŒæ ªæ•°: <span id="stocksOwned">0</span>æ ª</p>
    <p>ç¾åœ¨ã®æ ªä¾¡: <span id="currentStockPrice">1000</span>å††</p>
    <p>å€Ÿé‡‘æ®‹é«˜: <span id="debt">0</span>å††</p>
  </div>

  <div class="info">
    <button id="buyButton">æ ªã‚’è²·ã† (Bã‚­ãƒ¼)</button>
    <button id="sellButton">æ ªã‚’å£²ã‚‹ (Sã‚­ãƒ¼)</button>
    <button id="workButton">åƒã (Wã‚­ãƒ¼)</button>
    <button id="loanButton">å€Ÿé‡‘ (Dã‚­ãƒ¼)</button>
    <button id="repayButton">å€Ÿé‡‘è¿”æ¸ˆ (Rã‚­ãƒ¼)</button>
    <button id="giftButton">ã‚®ãƒ•ãƒˆã‚’é€ã‚‹ (Gã‚­ãƒ¼)</button> <!-- ã‚®ãƒ•ãƒˆé€ä¿¡ãƒœã‚¿ãƒ³ -->
  </div>

  <div id="message"></div>

  <!-- é…å½“ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
  <div id="popup">
    <p>ğŸ‰ 1æ—¥ã®é…å½“ãŒæ”¯æ‰•ã‚ã‚Œã¾ã—ãŸï¼ ğŸ‰</p>
    <p id="dividendMessage"></p>
    <button onclick="closePopup()">é–‰ã˜ã‚‹</button>
  </div>

  <!-- ã‚®ãƒ•ãƒˆé€ä¿¡ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
  <div id="giftPopup">
    <h2>ã‚®ãƒ•ãƒˆã‚’é€ã‚‹</h2>
    <p>å—ã‘å–ã‚‹å´ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</p>
    <input type="text" id="recipientPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <p>ã‚®ãƒ•ãƒˆé¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</p>
    <input type="number" id="giftAmount" placeholder="ã‚®ãƒ•ãƒˆé¡">
    <button onclick="sendGift()">ã‚®ãƒ•ãƒˆã‚’é€ã‚‹</button>
    <button onclick="closeGiftPopup()">é–‰ã˜ã‚‹</button>
  </div>

  <script>
    // åˆæœŸè¨­å®š
    let stockPrice = 1000;   // åˆæœŸæ ªä¾¡
    let money = 10000;       // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰€æŒé‡‘
    let stocksOwned = 0;     // æ‰€æŒæ ªæ•°
    let debt = 0;            // å€Ÿé‡‘
    let stockData = [stockPrice];  // æ ªä¾¡ãƒ‡ãƒ¼ã‚¿
    let timeLabels = ['0'];  // æ™‚é–“ãƒ©ãƒ™ãƒ«ï¼ˆ0åˆ†ï¼‰
    let lastDividendTime = Date.now();  // æœ€å¾Œã®é…å½“ã®æ™‚é–“
    let playerPassword = "1234";  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼‰

    // ã‚®ãƒ•ãƒˆé€ä¿¡å…ˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
    let recipientPassword = "abcd"; // å—ã‘å–ã‚Šå´ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼‰

    // ã‚¯ãƒƒã‚­ãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
    function loadDataFromCookies() {
      const cookieMoney = getCookie('money');
      const cookieStocksOwned = getCookie('stocksOwned');
      const cookieStockPrice = getCookie('stockPrice');
      const cookieDebt = getCookie('debt');
      const cookieLastDividendTime = getCookie('lastDividendTime');

      if (cookieMoney) money = parseFloat(cookieMoney);
      if (cookieStocksOwned) stocksOwned = parseInt(cookieStocksOwned);
      if (cookieStockPrice) stockPrice = parseFloat(cookieStockPrice);
      if (cookieDebt) debt = parseFloat(cookieDebt);
      if (cookieLastDividendTime) lastDividendTime = parseInt(cookieLastDividendTime);
    }

    // ã‚¯ãƒƒã‚­ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
    function saveDataToCookies() {
      setCookie('money', money, 7);
      setCookie('stocksOwned', stocksOwned, 7);
      setCookie('stockPrice', stockPrice, 7);
      setCookie('debt', debt, 7);
      setCookie('lastDividendTime', lastDividendTime, 7);
    }

    // ã‚¯ãƒƒã‚­ãƒ¼ã«å€¤ã‚’è¨­å®šã™ã‚‹é–¢æ•°
    function setCookie(name, value, days) {
      const expires = new Date();
      expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
      document.cookie = name + "=" + value + ";expires=" + expires.toUTCString() + ";path=/";
    }

    // ã‚¯ãƒƒã‚­ãƒ¼ã‹ã‚‰å€¤ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    // æ ªä¾¡ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateStockPrice() {
      const change = (Math.random() - 0.5) * 20; // -10å†† ï½ +10å†† ã®å¤‰å‹•
      stockPrice += change;

      // æ ªä¾¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
      stockData.push(stockPrice);
      timeLabels.push(timeLabels.length.toString());  // æ™‚é–“ã‚’è¿½åŠ 

      // æ ªä¾¡ã¨ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
      document.getElementById('currentStockPrice').textContent = stockPrice.toFixed(2);
      stockChart.update();
      saveDataToCookies();  // ã‚¯ãƒƒã‚­ãƒ¼ã«çŠ¶æ…‹ã‚’ä¿å­˜
    }

    // 1åˆ†ã”ã¨ã«æ ªä¾¡ã‚’æ›´æ–°
    setInterval(updateStockPrice, 60000);  // 60000ãƒŸãƒªç§’ï¼ˆ1åˆ†ï¼‰ã”ã¨ã«æ›´æ–°

    // é…å½“ã®æ”¯æ‰•ã„
    function payDividend() {
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000; // 1æ—¥åˆ†ã®ãƒŸãƒªç§’
      if (now - lastDividendTime >= oneDay) {
        const dividend = money * 0.01;  // é…å½“ã¯æ‰€æŒé‡‘ã®1%
        money += dividend;  // é…å½“ã‚’æ‰€æŒé‡‘ã«åŠ ç®—
        lastDividendTime = now;  // æœ€å¾Œã®é…å½“æ™‚åˆ»ã‚’æ›´æ–°
        saveDataToCookies();  // ã‚¯ãƒƒã‚­ãƒ¼ã«ä¿å­˜
        showPopup(dividend);  // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
      }
    }

    // é…å½“ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®è¡¨ç¤º
    function showPopup(dividend) {
      const message = `é…å½“: ${dividend.toFixed(2)}å††ãŒæ”¯æ‰•ã‚ã‚Œã¾ã—ãŸï¼`;
      document.getElementById('dividendMessage').textContent = message;
      document.getElementById('popup').style.display = 'block';
    }

    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
    function closePopup() {
      document.getElementById('popup').style.display = 'none';
    }

    // ã‚®ãƒ•ãƒˆé€ä¿¡ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã
    function openGiftPopup() {
      document.getElementById('giftPopup').style.display = 'block';
    }

    // ã‚®ãƒ•ãƒˆé€ä¿¡ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
    function closeGiftPopup() {
      document.getElementById('giftPopup').style.display = 'none';
    }

    // ã‚®ãƒ•ãƒˆã‚’é€ã‚‹
    function sendGift() {
      const recipientPasswordInput = document.getElementById('recipientPassword').value;
      const giftAmount = parseFloat(document.getElementById('giftAmount').value);

      if (recipientPasswordInput === recipientPassword) {
        if (money >= giftAmount) {
          money -= giftAmount;  // é€ä¿¡è€…ã®æ‰€æŒé‡‘ã‹ã‚‰æ¸›ç®—
          alert(`ã‚®ãƒ•ãƒˆ ${giftAmount}å†† ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼`);
          updateUI();  // UIã‚’æ›´æ–°
        } else {
          alert("æ‰€æŒé‡‘ãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
        }
      } else {
        alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ï¼");
      }

      closeGiftPopup();  // ã‚®ãƒ•ãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
    }

    // UIã®æ›´æ–°
    function updateUI() {
      document.getElementById('money').textContent = money.toFixed(2);
      document.getElementById('stocksOwned').textContent = stocksOwned;
      document.getElementById('debt').textContent = debt.toFixed(2);
      saveDataToCookies();  // çŠ¶æ…‹ã‚’ã‚¯ãƒƒã‚­ãƒ¼ã«ä¿å­˜
    }

    // ã‚­ãƒ¼æ“ä½œã§æ ªã‚’è²·ã†/å£²ã‚‹/åƒã/å€Ÿé‡‘/è¿”æ¸ˆ
    document.addEventListener('keydown', (event) => {
      if (event.key === 'b' || event.key === 'B') {
        buyStock();
      } else if (event.key === 's' || event.key === 'S
